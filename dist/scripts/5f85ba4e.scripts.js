"use strict";function CostTypeController(a,b,c,d,e,f){function g(){if(!a.costReport)return void console.log("copyReport: no costReport");var b={prev:{costs:angular.copy(a.costReport.costs),costsCurrent:a.costReport.costsCurrent,costsDelta:a.costReport.costsDelta}},e=c.defer(),f=c.defer();b.promise=e.promise,b.undoPromise=f.promise,b.execute=function(){console.log("calculateCosts: execute");var b=0;angular.forEach(a.temp.costs,function(a,c){var d=a.quantity||0;b+=d*a.costsPerUnit}),b/=1e3,a.costReport.costs=angular.copy(a.temp.costs),a.costReport.costsCurrent=Math.round(b),a.costReport.costsCurrent&&a.costReport.costsPlanned?a.costReport.costsDelta=h(a.costReport.costsCurrent,a.costReport.costsPlanned):a.costReport.costsDelta=null,a.costReport.$update().then(function(){e.resolve()})["catch"](function(a){handleUpdateError(a,e)}),delete a.temp.costs},b.undo=function(){console.log("calculateCosts: undo"),a.costReport.costs=b.prev.costs,a.costReport.costsCurrent=b.prev.costsCurrent,a.costReport.costsDelta=b.prev.costsDelta,a.costReport.$update().then(function(){f.resolve()})["catch"](function(a){handleUpdateError(a,f)}),delete a.temp.costs},d.storeAndExecuteCmd(b)}function h(a,b){var c=a/b;return c=Math.round(100*c)}function i(){var b=angular.element("#costDialog .modal");b||console.log("No cost dialog found."),a.temp=a.temp?a.temp:{},a.costReport.costs?a.temp.costs=angular.copy(a.costReport.costs):a.temp.costs=[],a.costReport.locked||b.modal("toggle")}function j(b){a.temp.costs.splice(b,1)}function k(){var b={name:"Type",costsPerUnit:1,unit:"h",quantity:0};a.temp.costs.push(b)}function l(a){return a?"number"!=typeof a.quantity||"number"!=typeof a.costsPerUnit?0:a.quantity*a.costsPerUnit/1e3:0}a.config=e,a.calculateCosts=g,a.toggleCostDialog=i,a.removeCostType=j,a.addCostType=k,a.calculateCostForPosition=l,a.isZero=f.isZero}angular.module("PReports.resources",[]),angular.module("PReports.directives",[]),angular.module("PReports.services",[]),Date.prototype.getWeek=function(a){a="int"==typeof a?a:1;var b=new Date(this.getFullYear(),0,1),c=b.getDay()-a;c=c>=0?c:c+7;var d,e,f,g=Math.floor((this.getTime()-b.getTime()-6e4*(this.getTimezoneOffset()-b.getTimezoneOffset()))/864e5)+1;return 4>c?(d=Math.floor((g+c-1)/7)+1,d>52&&(e=new Date(this.getFullYear()+1,0,1),f=e.getDay()-a,f=f>=0?f:f+7,d=4>f?1:53)):d=Math.floor((g+c-1)/7),d},angular.module("PReports",["ngCookies","ngResource","ngSanitize","ngRoute","PReports.resources","PReports.directives","PReports.services","PReports.translations","PReports.filters","angularFileUpload","ui.bootstrap","ui.sortable","textAngular","cfp.hotkeys"]).config(["$routeProvider","$httpProvider","$provide","$logProvider",function(a,b,c,d){a.when("/reports",{templateUrl:"views/reports.html",controller:"ReportCtrl",reloadOnSearch:!1}).when("/reports/:reportId",{templateUrl:"views/reports_detail.html",controller:"ReportCtrl"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/reports"}),b.defaults.headers.common.Accept="application/hal+json",d.debugEnabled(!1),c.decorator("taOptions",["$delegate",function(a){return a.forceTextAngularSanitize=!0,a.toolbar=[["h3","h4","p","bold","italics","underline","ul","ol"]],a}])}]).run(["$rootScope","config",function(a,b){a.version=b.version}]),angular.module("PReports").controller("ReportCtrl",["$scope","$location","$routeParams","Report","$log","$http","FileUploader","config","errorHandler","$rootScope","language","$timeout","$interval","$interpolate","helper","hotkeys","notification","commandService","$q","reportsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(){a.reportSortableOptions={disabled:a.isReportLocked(),axis:"y",update:function(b,c){var d={},e=s.defer(),f=s.defer(),g=angular.copy(a.currentReport.milestones);d.promise=e.promise,d.undoPromise=f.promise,d.execute=function(){a.currentReport.$update().then(function(){e.resolve()})["catch"](function(a){R(a,e)})},d.undo=function(){a.currentReport.milestones=g,a.currentReport.$update().then(function(){f.resolve()})["catch"](function(){R(response,f)})},G(d)}}}function v(b,c){if(e.debug("loadReports"),a.selectedReportSearchRow=null,K(j.search.year),a.reportsWrapper&&a.reportsWrapper._links){if("next"==b&&a.reportsWrapper._links.next)return void f.get(h.getCombinedServiceUrl()+a.reportsWrapper._links.next.href).success(function(b){a.reportsWrapper=b,a.reports=b.reports,j.search.page=b.currentPage-1,w(j.search)}).error(i);if("prev"==b&&a.reportsWrapper._links.prev)return void(a.reportsWrapper=f.get(h.getCombinedServiceUrl()+a.reportsWrapper._links.prev.href).success(function(b){a.reportsWrapper=b,a.reports=b.reports,j.search.page=b.currentPage-1,w(j.search)}).error(i))}t.getReports(j.search).then(function(b){e.debug("success callback getReports"),a.reportsWrapper=b,a.reports=a.reportsWrapper.reports,j.search.page=a.reportsWrapper.currentPage-1,w(j.search)})["catch"](function(a){i(a)})}function w(a){var c=y(a);b.search(c)}function x(){var a,c=b.search();0!=Object.keys(c).length&&(a=y(c),j.search=a)}function y(a){var b={};return a&&(a.week&&(b.week=parseInt(a.week)),a.year?b.year=parseInt(a.year):b.year=(new Date).getFullYear(),a.name&&(b.name=a.name),a.page&&(b.page=a.page),a.sortDirection&&(b.sortDirection=a.sortDirection),a.sortProperty&&(b.sortProperty=a.sortProperty)),b}function z(){var b,c,d,f,g="";e.debug("registerWatchForSearch"),j.watchHandles||(j.watchHandles=[]),c=j.$watch("search.name",function(c,d){c!=d&&(b&&l.cancel(b),g=c,b=l(function(){a.filterText=g,j.search.page=0,a.loadReports()},250))}),j.watchHandles.push(c),c=j.$watch("search.year",function(b,c){b!=c&&(j.search.page=0,d=o.getMaxWeeksPerYear(c),j.search.week===d?(f=o.getMaxWeeksPerYear(b),d>f?j.search.week=f:a.loadReports()):a.loadReports())}),j.watchHandles.push(c),c=j.$watch("search.week",function(b,c){b!=c&&(j.search.page=0,a.loadReports())}),j.watchHandles.push(c)}function A(){j.watchHandles&&j.watchHandles.length>0&&angular.forEach(j.watchHandles,function(a){a()}),j.watchHandles=[]}function B(b){return b?(a.reportNotFound=!1,void(a.currentReport=d.get({id:b},function(){K(),u()},function(b){a.reportNotFound=!0,i(b)}))):void e.log("loadReport: No Id provided.")}function C(b){var c={},d=new Date;c.year=d.getFullYear(),c.week=d.getWeek(),c.name=b||a.newReportName,c.milestones=[],c.costs=angular.copy(h.defaultCostTypes),D(c)}function D(c){var e;return c?(e=new d(c),void(c._id||e.$create(function(c){console.log("saved new report"),a.newReportName=null,b.url("reports/"+e._id)},function(c){409==c.status&&(c.data.errorKey="error.report.clone"),i(c),409==c.status&&(a.newReportName=null,b.url("reports/"+c.data._id))}))):void console.log("saveReport: no report given")}function E(b){if("milestone"==b)return a.currentReport.milestones;if("recipient"==b)return a.currentReport.settings.notification.recipients;if("system"==b)return a.currentReport.systems;throw"getReportCollectionByType: "+b+" collection type unknown"}function F(){var b=a.uploader=new g({scope:a,url:h.getCombinedServiceUrl()+"/reports/"+c.reportId+"/images",alias:"image",removeAfterUpload:!0,autoUpload:!1});b.filters.push({name:"imageFilter",fn:function(a,c){var d=b.isHTML5?a.type:"/"+a.value.slice(a.value.lastIndexOf(".")+1);return d="|"+d.toLowerCase().slice(d.lastIndexOf("/")+1)+"|",-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(d)}}),b.onCompleteItem=function(b,c,d,f){e.log(c),200==d&&(a.currentReport.images||(a.currentReport.images=[]),a.currentReport.images.push(c))},b.onCompleteAll=function(){J(a.currentReport,function(b){a.currentReport.version=b.version})},b.onErrorItem=function(a,b,c,d){console.log("setupFileUpload: upload failed"),j.error=!0,j.errorMessage=k.translate(b)||k.translate("error.image.upload")||k.translate("error.general")||"Error during communication with service."}}function G(a){r.storeAndExecuteCmd(a)}function H(){f.get(a.config.getCombinedServiceUrl()+"/reports",{headers:{Accept:"text/plain"}}).success(function(b,c,d,e){a.projectNames=b}).error(i)}function I(a){return a?(a.year=parseInt(a.year),void(a.week=parseInt(a.week))):void console.log("convertCalAndWeekToInt: no report given")}function J(a,b){return a?void f.get(h.getCombinedServiceUrl()+a._links.self.href+"/version").success(function(a){console.log("Retrieved version "+a.version+" for report id "+a._id),b(a)}).error(i):void console.log("loadReportVersion: no report given")}function K(b){var c,d,e=[];c=b?new Date(b,11,28):new Date(a.currentReport.year,11,28),d=c.getWeek();for(var f=1;d>=f;f++)e.push({week:f});a.weeks=e}function L(){a.brandLogoExists=h.brandLogoExists,a.brandLogo=h.brandLogo}function M(){a.$on("report-change-year",function(a){K()})}function N(){p.bindTo(a).add({combo:"ctrl+z",description:"Undo",callback:function(){a.removeAndUndoLastCommand()}}).add({combo:"plus",description:"Increase report week",callback:function(){a.incrementalUpdateReportWeek("inc")}}).add({combo:"-",description:"Decrease report week",callback:function(){a.incrementalUpdateReportWeek("dec")}}).add({combo:"l",description:"Lock report",callback:function(){a.toggleReportLock()}}),p.del("esc")}function O(){p.bindTo(a).add({combo:"a",description:"Show all weeks",callback:function(){a.search.week=""}}).add({combo:"t",description:"Reset week and year",callback:function(){a.resetSearchCal()}}).add({combo:"r",description:"Reload reports",callback:function(){a.loadReports()}}).add({combo:"c",description:"Clear search",callback:function(){a.search.name=""}}).add({combo:"n",description:"New report",callback:function(a,b){a.preventDefault(),angular.element("#report_new_title_field").focus(),angular.element("compose-button .fab").click()}}).add({combo:"s",description:"Search",callback:function(a,b){a.preventDefault(),angular.element("#report_search_field").focus()}}).add({combo:"esc",description:"Unfocus field",allowIn:["INPUT"],callback:function(a){return angular.element("input").blur(),!0}}).add({combo:"down",description:"Select next result",callback:function(){if(null===a.selectedReportSearchRow)a.selectedReportSearchRow=0;else{if(a.selectedReportSearchRow===a.reports.length-1)return;a.selectedReportSearchRow=a.selectedReportSearchRow+1}}}).add({combo:"up",description:"Select prev result",callback:function(){if(null===a.selectedReportSearchRow)a.selectedReportSearchRow=a.reports.length-1;else{if(0===a.selectedReportSearchRow)return;a.selectedReportSearchRow=a.selectedReportSearchRow-1}}}).add({combo:"enter",description:"Show selected report",callback:function(){a.selectedReportSearchRow>=0&&a.selectedReportSearchRow<a.reports.length&&b.url("reports/"+a.reports[a.selectedReportSearchRow]._id)}}).add({combo:"right",description:"Next page",callback:function(){a.loadReports("next")}}).add({combo:"left",description:"Previous page",callback:function(){a.loadReports("prev")}})}function P(){q.getProviders(function(b){a.notificationProviders=b})}function Q(){e.debug("activate"),c.reportId?(A(),N(),B(c.reportId),L()):(x(),v(),H(),z(),O()),F(),M(),P()}function R(a,b){a&&(b&&b.reject(),428==a.status?(e.log("Failed to update report because it has been modified."),r.reset(),$("#dialogModifiedReport").modal("toggle")):i(a))}var S=3e3;a.reports=[],a.currentReport=null,a.years=[2014,2015,2016,2017],a.config=h,a.projectNames=[],a.reportNotFound=!1,a.commandService=r,r.reset(),a.selectedReportSearchRow=null,a.notificationProviders=null,a.loadReport=B,a.loadReports=v,a.createNewReport=C,a.language=k,Q(),a.sortList=function(b){b&&(b!=j.search.sortProperty?(j.search.sortDirection="asc",j.search.sortProperty=b):"asc"==j.search.sortDirection?j.search.sortDirection="desc":j.search.sortDirection="asc",a.loadReports())},a.reloadReport=function(b){return a.currentReport?(a.reportNotFound=!1,void(a.currentReport=d.get({id:a.currentReport._id},function(){},function(b){a.reportNotFound=!0,i(b)}))):void e.log("loadReport: No currentReport.")},a.showReport=function(a,c){a&&c&&"TD"==c.target.tagName&&b.path("reports/"+a).search({})},a.updateReport=function(b,c,d,e,f){function g(a,b){var c,d;if(!b)return!1;if(c=b.split("."),c.length>0){d=a;for(var e=0;e<c.length;e++){if(!c[e]||!c[e].length)return!1;d=d[c[e]]}}return d}var h,i=s.defer(),j=s.defer();if(!a.currentReport)return void console.log("updateReport: no current report");if(h={mP:b,pV:c,iA:d,i:e,aN:f,promise:i.promise,undoPromise:j.promise},d&&"number"==typeof e&&f){var k=g(a.currentReport,f);h.nV=k[e][h.mP]}else h.nV=a.currentReport[h.mP];I(a.currentReport),h.execute=function(){if(d&&"number"==typeof e&&f){var b=g(a.currentReport,f);b[e][h.mP]=h.nV}else a.currentReport[h.mP]=h.nV;a.currentReport.$update(function(){a.$emit("report-change-"+h.mP),i.resolve()},function(a){R(a,i)})},h.mP&&(h.undo=function(){if(d&&"number"==typeof e&&f){var b=g(a.currentReport,f);b[e][h.mP]=h.pV}else a.currentReport[h.mP]=h.pV;a.currentReport.$update(function(){a.$emit("report-change-"+h.mP),j.resolve()},function(a){R(a,j)})}),G(h),u()},a.updateReportYear=function(b,c){function d(){g={prev:{week:parseInt(a.currentReport.week),year:parseInt(c)},promise:h.promise,undoPromise:i.promise},g.execute=function(){a.currentReport.week=parseInt(f),a.currentReport.$update(function(){h.resolve()},function(a){R(a,h)}),a.$emit("report-change-year")},g.undo=function(){a.currentReport.year;a.currentReport.week=g.prev.week,a.currentReport.year=g.prev.year,a.currentReport.$update(function(){i.resolve()},function(a){R(a,i)}),a.$emit("report-change-year")},G(g)}var e,f,g,h=s.defer(),i=s.defer();e=o.getMaxWeeksPerYear(c),a.currentReport.week===e?(f=o.getMaxWeeksPerYear(b),e>f?d():a.updateReport("year",parseInt(c),!1)):a.updateReport("year",parseInt(c),!1)},a.updateReportWeek=function(b,c){a.updateReport("week",parseInt(c),!1)},a.incrementalUpdateReportWeek=function(b){var c=s.defer(),d=s.defer();if(!a.isReportLocked()){if(!b)return void e.log("No valid direction given.");if("dec"!=b&&"inc"!=b)return void e.log("No valid direction provided. "+b);var f,g=(a.currentReport.week,"dec"==b?a.currentReport.year-1:a.currentReport.year),h=new Date(g,11,28),i=h.getWeek();f={prev:{week:a.currentReport.week,year:a.currentReport.year},promise:c.promise,undoPromise:d.promise},f.execute=function(){"dec"==b?a.currentReport.week>1?a.currentReport.week--:(a.currentReport.week=i,a.currentReport.year--):"inc"==b&&(a.currentReport.week<i?a.currentReport.week++:(a.currentReport.week=1,a.currentReport.year++)),a.currentReport.$update(function(){f.prev.year!=a.currentReport.year&&a.$emit("report-change-year"),c.resolve()},function(a){R(a,c)})},f.undo=function(){var b=a.currentReport.year;a.currentReport.week=f.prev.week,a.currentReport.year=f.prev.year,a.currentReport.$update(function(){b!=a.currentReport.year&&a.$emit("report-change-year"),d.resolve()},function(a){R(a,d)})},G(f)}},a.deleteReport=function(c){function d(){f["delete"](h.getCombinedServiceUrl()+a.reportToDelete._links.self.href).success(function(c,d,e,f){"/reports"==b.path()?angular.forEach(a.reports,function(b,c){return a.reportToDelete._id==b._id?(a.reports.splice(c,1),a.reportToDelete=null,!1):void 0}):b.path("/")}).error(i)}function e(){a.remainingSecondsBeforeDoomsday>0?a.remainingSecondsBeforeDoomsday=a.remainingSecondsBeforeDoomsday-1:(a.deleteTimer=!1,d())}return a.reportToDelete=c||a.currentReport,a.reportToDelete?(a.remainingSecondsBeforeDoomsday=Math.round(S/1e3),a.deleteTimer=!0,void(a.doomsdayInterval=m(e,1e3,a.remainingSecondsBeforeDoomsday+1))):void console.log("deleteReport: no report to delete")},a.delayDoomsday=function(){a.deleteTimer=!1,a.doomsdayInterval&&(m.cancel(a.doomsdayInterval),a.doomsdayInterval=null)},a.addCollectionElement=function(b){var c={},d=s.defer(),f=s.defer();if(!a.currentReport)return void e.log("addSystem: no current report");if("milestone"==b)a.currentReport.milestones||(a.currentReport.milestones=[]);else if("recipient"==b)a.currentReport.settings?a.currentReport.settings.notification?a.currentReport.settings.notification.recipients||(a.currentReport.settings.notification.recipients=[]):(a.currentReport.settings.notification={},a.currentReport.settings.settings.notification.recipients=[]):(a.currentReport.settings={},a.currentReport.settings.notification={},a.currentReport.settings.notification.recipients=[]);else{if("system"!=b)return void e.log("addCollectionElement: unknown type");a.currentReport.systems||(a.currentReport.systems=[])}I(a.currentReport),c.promise=d.promise,c.undoPromise=f.promise,c.execute=function(){E(b).push({}),a.currentReport.$update().then(function(){d.resolve()})["catch"](function(a){R(a,d)})},c.undo=function(){E(b).pop(),a.currentReport.$update().then(function(){f.resolve()})["catch"](function(a){R(a,f)})},G(c)},a.removeCollectionElement=function(b,c){var d,f={},g=s.defer(),h=s.defer();if(!a.currentReport)return void e.log("removeCollectionElement: no current report");if(!c&&0!==c)return void e.log("removeCollectionElement: no index given");if("milestone"==b){if(!a.currentReport.milestones||0==a.currentReport.milestones.length||!a.currentReport.milestones[c])return}else if("recipient"==b){if(!(a.currentReport.settings&&a.currentReport.settings.notification&&a.currentReport.settings.notification.recipients&&0!=a.currentReport.settings.notification.recipients.length&&a.currentReport.settings.notification.recipients[c]))return void e.log("removeCollectionElement: precondition checks on settings object failed")}else if("system"==b){if(!a.currentReport.systems||0==a.currentReport.systems.length||!a.currentReport.systems[c])return}else e.log("removeCollectionElement: unknown type");I(a.currentReport),f.promise=g.promise,f.undoPromise=h.promise,f.execute=function(){var e=E(b);d=e[c],e.splice(c,1),a.currentReport.$update().then(function(){g.resolve()})["catch"](function(a){g.reject()})},f.undo=function(){var e=E(b);e.splice(c,0,d),a.currentReport.$update().then(function(){h.resolve()})["catch"](function(a){h.reject()})},G(f)},a.sendNotifications=function(){return a.currentReport?void f.post(h.getCombinedServiceUrl()+"/reports/"+a.currentReport._id+"/notifications").success(angular.noop).error(function(a){e.error("Failed so send notifications "+a),i(a)}):void console.log("sendNotifications: no current report")},a.deleteReportImage=function(b){return b?a.currentReport?void f["delete"](h.getCombinedServiceUrl()+b._links.self.href).success(function(c,d,e,f){angular.forEach(a.currentReport.images,function(c,d){return c._id==b._id?(a.currentReport.images.splice(d,1),!1):void 0}),J(a.currentReport,function(b){a.currentReport.version=b.version})}).error(i):void console.log("deleteReportImage: no current report"):void console.log("deleteReportImage: no image given")},a.printReport=function(){return a.currentReport?void window.print():void console.log("printReport: no current report")},a.copyReport=function(a,b){var c=new Date;return a?(a.copyOf=a._id,delete a._id,a.name=a.name+"_copy",a.week=c.getWeek(),a.year=c.getFullYear(),a.locked=!1,void D(a)):void console.log("copyReport: no reportToCopy given")},a.toggleReportLock=function(){var b;return a.currentReport?("undefined"!=typeof a.currentReport.locked?(b=a.currentReport.locked,a.currentReport.locked=!b):(b=!1,a.currentReport.locked=!0),void a.updateReport()):void console.log("copyReport: no currentReport")},a.isReportLocked=function(){return a.currentReport?a.currentReport.locked:!1},a.isUrl=function(a){return o.isUrl(a)},a.removeAndUndoLastCommand=function(){a.isReportLocked()||r.undo()},a.isZero=function(a){return o.isZero(a)},a.getStateColor=function(a){var b="";if(!a)return"";switch(a){case 1:b="red";break;case 2:b="yellow";break;case 3:b="green"}return b},a.resetSearchCal=function(){j.search.year=(new Date).getFullYear(),j.search.week=(new Date).getWeek()}}]),angular.module("PReports").controller("NavigationCtrl",["$scope","$route","language","config","$location","$http","$log","$rootScope",function(a,b,c,d,e,f,g,h){function i(){var b;window.localStorage&&(b=window.localStorage.getItem(k),b||(b=c.get()),a.user.language=b)}function j(){f.get(d.getCombinedServiceUrl()+"/reports/count").success(function(a,b,c,d){h.reportsCount=a}).error(function(){g.log("getReportsCount: failed to get reports count")})}var k="preports.user.language";a.user={},a.setUserLanguage=function(){a.user.language&&window.localStorage&&(window.localStorage.setItem(k,a.user.language),c.set(a.user.language),b.reload())},a.inIFrame=function(){var a=!0;try{a=window.self!==window.top}catch(b){return!0}return a},i(),"/about"==e.path()&&j()}]),angular.module("PReports.resources").factory("genericResource",["$resource","config","errorHandler",function(a,b,c){function d(d,e,f){var g=a(b.getCombinedServiceUrl()+d,e,f);return g.prototype.saving=!1,g.prototype.isSaving=function(){return g.prototype.saving},g.prototype.setSaving=function(a){g.prototype.saving=a},g.prototype.$create=function(a,b,d){var e,f,g=this,h=angular.noop;switch(arguments.length){case 3:e=a,h=b,f=d;break;case 2:case 1:angular.isFunction(a)?(h=a,f=b||c):(e=a,h=b||angular.noop,f=c);case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}g.setSaving(!0),g.$save(e,function(a,b){g.setSaving(!1),h(a,b)},function(a,b,c,d){g.setSaving(!1),f(a,b,c,d)})},g}return d}]),angular.module("PReports.resources").factory("Report",["genericResource",function(a){var b=a("/reports/:id",{id:"@_id"},{update:{method:"PUT"},query:{method:"GET",isArray:!1}});return b}]),angular.module("PReports.translations",[],["$provide",function(a){var b={"error.image.upload":{DE:"Bild hochladen fehlgeschlagen.",EN:"Image upload failed."},"error.404":{DE:"404 Eine Ressource konnte nicht geladen werden.",EN:"404 Resource not available."},"error.403":{DE:"Ungültige Zugangsdaten oder keine Zugriffsrechte.",EN:"Invalid credentials or insufficient access rights."},"error.demo":{DE:"Dieses Feature ist in der Demo nicht verfügbar.",EN:"This feature is not available in demo."},"error.general":{DE:"Ein Problem ist aufgetreten. Versuchen Sie neu zu laden.",EN:"There has been a problem. Try reloading."},"error.report.clone":{DE:"Beim Kopieren traten Fehler auf. Eventuell konnten Bilder nicht kopiert werden.",EN:"Error during copy. Eventually images could not be copied."},"error.appengine":{DE:"Es liegt eine Serverstörung vor. Wir arbeiten an einer Lösung.",EN:"The service has been temporarily interrupted. We are working on a solution."},"common.sending":{DE:"Sende...",EN:"Sending..."},"common.send":{DE:"Sende",EN:"Send"},"common.password.invalid":{DE:"Passwort inkorrekt!",EN:"Password invalid!"},"common.more":{DE:"Mehr",EN:"More"},reports:{DE:"Reports",EN:"Reports"},"reports.back":{DE:"Reports",EN:"Reports"},"reports.new":{DE:"Neuer Report",EN:"New report"},"reports.new.button":{DE:"Neuer Report",EN:"New report"},"reports.table.name":{DE:"Projektname",EN:"Project name"},"reports.table.year":{DE:"Jahr",EN:"Year"},"reports.table.week":{DE:"Woche",EN:"Week"},"reports.table.images":{DE:"Infografiken",EN:"Infographics"},"reports.table.actions":{DE:"Aktion",EN:"Action"},"reports.search.clear":{DE:"Suche löschen",EN:"Clear search"},"reports.search.today":{DE:"Aktuelle KW",EN:"Current calendar week"},"reports.search.all":{DE:"Alle Wochen",EN:"All weeks"},"reports.search.refresh":{DE:"Aktualisieren",EN:"Refresh"},"report.name":{DE:"Projektname",EN:"Project name"},"report.start.title":{DE:"Start",EN:"Start"},"report.start.ph":{DE:"Startdatum eingeben",EN:"Enter start date"},"report.golive.title":{DE:"Go live",EN:"Go live"},"report.golive.ph":{DE:"Go live eingeben",EN:"Enter go live"},"report.year":{DE:"Jahr",EN:"Year"},"report.week":{DE:"Kalenderwoche",EN:"Calendar week"},"report.leaddevelopers.title":{DE:"Lead developers",EN:"Lead developers"},"report.leaddevelopers.ph":{DE:"Entwickler eingeben",EN:"Enter developers"},"report.executivesponsor.title":{DE:"Executive Sponsor",EN:"Executive Sponsor"},"report.executivesponsor.ph":{DE:"Executive Sponsor eingeben",EN:"Enter executive sponsor"},"report.partner.title":{DE:"Partner",EN:"Partner"},"report.partner.ph":{DE:"Partner eingeben",EN:"Enter partner"},"report.projectmanagers.title":{DE:"Projektmanager",EN:"Project manager"},"report.projectmanagers.ph":{DE:"Manager eingeben",EN:"Enter manager"},"report.milestones":{DE:"Meilensteine",EN:"Milestones"},"report.milestones.ph":{DE:"Meilenstein eintragen",EN:"Enter milestone"},"report.milestones.start":{DE:"Meilenstein Start",EN:"Milestone start"},"report.milestones.end":{DE:"Meilenstein Datum",EN:"Milestone date"},"report.milestones.name":{DE:"Name",EN:"Name"},"report.milestones.milestone.name.ph":{DE:"Neuer Meilenstein",EN:"New milestone"},"report.lastweektasks":{DE:"Ergebnisse",EN:"Achievements"},"report.nextweektasks":{DE:"Nächste Aufgaben",EN:"Next objectives"},"report.tasks.ph":{DE:"Aufgaben eingeben",EN:"Enter tasks"},"report.potentials":{DE:"Identifizierte Potentiale",EN:"Identified potentials"},"report.potentials.ph":{DE:"Potentiale eingeben",EN:"Enter potentials"},"report.risks":{DE:"Risiken & Behinderungen",EN:"Risks & Impediments"},"report.risks.ph":{DE:"Risiken/Behinderungen eingeben",EN:"Enter risks/impediments"},"report.codereviews":{DE:"Code Reviews",EN:"Code reviews"},"report.codereviews.reviewer":{DE:"Reviewer",EN:"Reviewer"},"report.codereviews.reviewer.ph":{DE:"Reviewer eintragen",EN:"Enter reviewer"},"report.codereviews.topic":{DE:"Thema",EN:"Topic"},"report.codereviews.topic.ph":{DE:"Thema eintragen",EN:"Enter topic"},"report.codereviews.content":{DE:"Ergebnis",EN:"Result"},"report.codereviews.content.ph":{DE:"Ergenisse eintragen",EN:"Enter results"},"report.systems":{DE:"Systeme",EN:"Systems"},"report.systems.name":{DE:"Systemname",EN:"System name"},"report.systems.name.ph":{DE:"Systemname eintragen",EN:"Enter system name"},"report.systems.url":{DE:"Url",EN:"Url"},"report.systems.url.ph":{DE:"Url eintragen (http://)",EN:"Enter url (http://)"},"report.systems.remarks":{DE:"Bemerkungen",EN:"Remarks"},"report.systems.remarks.ph":{DE:"Bemerkungen eintragen (z. B. Zugangsdaten)",EN:"Enter remarks (e.g. credentials)"},"report.images":{DE:"Infografiken",EN:"Infographics"},"report.delete.title":{DE:"Report löschen",EN:"Delete report"},"report.delete.text":{DE:"Report wird unwideruflich gelöscht!",EN:"Report will be deleted permanent!"},"report.copy.title":{DE:"Report kopieren",EN:"Copy report"},"report.copy.text":{DE:"Erzeugt eine Kopie des Reports, setzt aktuelle Kalenderwoche und Jahr.",EN:"Creates a copy of this report and uses current calendar week."},"report.copyof":{DE:"Dies ist eine Kopie",EN:"This is a copy"},"report.lastmodified":{DE:"Zuletzt geändert",EN:"Last modified"},"report.createdon":{DE:"Erstellt am",EN:"Created on"},"report.killing.msg":{DE:"Lösche Report {{reportToDelete.name}} in "},"report.428.title":{DE:"Report wure bearbeitet"},"report.428.msg":{DE:"Der Report wurde in der Zwischenzeit bearbeitet. Sie können Neuladen und die letzte Änderung verwerfen oder abbrechen, Ihre letzte Änderung sichern und manuell neuladen. Der Undo Stack wurde geleert, um Überschreiben zu verhindern."},"report.428.cancel":{DE:"Abbrechen"},"report.428.reload":{DE:"Neuladen und verwerfen"},"report.notification":{DE:"Empfänger für Report-Benachrichtigung",EN:"Recipients for report notification"},"report.notification.info":{DE:"E-Mails von Personen hinzufügen, um diesen Benachrichtigungen schicken zu können.",EN:"Add emails of people you want to notify."},"report.notification.title":{DE:"Benachrichtigung senden",EN:"Send notification"},"report.notification.text":{DE:"Benachrichtigung an eingetragene Empfänger mit Link zu diesem Report schicken?",EN:"Send a notification to recipients with a link to this report?"},"report.notification.recipient":{DE:"Empfänger",EN:"Recipient"},"report.notification.recipient.ph":{DE:"E-Mail oder Username eingeben",EN:"Enter email or username"},"report.signal.budget":{DE:"Budget",EN:"Budget"},"report.signal.time":{DE:"Time",EN:"Time"},"report.signal.quality":{DE:"Quality",EN:"Quality"},"report.costs.table.th.title":{DE:"K€",EN:"K€"},"report.costs.table.th.current":{DE:"Aktuell",EN:"Current"},"report.costs.table.th.rest":{DE:"Rest",EN:"Rest"},"report.costs.table.tr.title":{DE:"Kosten(total)",EN:"COST(total)"},"report.costs.plan":{DE:"Geplant",EN:"Plan"},"report.costs.plan.invalid":{DE:"Bitte Zahl größer 0 eingeben.",EN:"Please enter value bigger 0"},"report.costs.plan.ph":{DE:"Eingabe in K€",EN:"Enter in K€"},"report.costs.current.ph":{DE:"Aktuelle Kosten",EN:"Current costs"},"report.costs.rest":{DE:"Verbleibende Kosten",EN:"Remaining costs"},"report.costs.rest.ph":{DE:"Verbleibend",EN:"Remaining"},"report.costs.dialog.title":{DE:"Kostenberechnung",EN:"Costs calculations"},"report.costs.dialog.msg":{DE:"Geben Sie die aufgewendeten Einheiten für die Kostentypen an.",EN:"Enter units spend for cost types."},"report.costs.dialog.table.type":{DE:"Typ",EN:"Type"},"report.costs.dialog.table.quantity":{DE:"Anzahl",EN:"Quantity"},"report.costs.dialog.table.unit":{DE:"Einheit",EN:"Unit"},"report.costs.dialog.table.costsPerUnit":{DE:"€/Einh.",EN:"€/Unit"},"report.ordernumber.title":{DE:"#Projekt Nr.",EN:"#Project No."},"report.ordernumber.ph":{DE:"Projektnummer eingeben",EN:"Enter project number"},"report.time.plan.title":{DE:"Plan",EN:"Plan"},"report.time.current.title":{DE:"Aktuell",EN:"Current"},"report.time.plan":{DE:"Plan",EN:"Plan"},"report.time.plan.ph":{DE:"Geplanter GoLive",EN:"Planned GoLive"},"report.time.current":{DE:"Aktuell",EN:"Current"},"report.time.current.ph":{DE:"Aktueller GoLive",EN:"Current GoLive"},"report.time.time.title":{DE:"Zeit",EN:"Time"},back:{DE:"zurück",EN:"back"},start:{DE:"Start",EN:"Start"},end:{DE:"Ende",EN:"End"},save:{DE:"Speichern",EN:"Save"},create:{DE:"Anlegen",EN:"Create"},cancel:{DE:"Abbrechen",EN:"Cancel"},enter:{DE:"Eingeben",EN:"Enter"},or:{DE:"oder",EN:"or"},all:{DE:"alle",EN:"all"},"file.dropzone":{DE:"Bilder hierher ziehen",EN:"Drop images"},search:{DE:"Suche",EN:"Search"},"delete":{DE:"Löschen",EN:"Delete"},copy:{DE:"Kopieren",EN:"Copy"},print:{DE:"Drucken",EN:"Print"},undo:{DE:"Rückgängig",EN:"Undo"},lock:{DE:"Editierfunktion sperren",EN:"Disable edit mode"},send:{DE:"Benachrichtigung senden",EN:"Send notifications"},"error.title":{DE:"Fehler",EN:"Error"},next:{DE:"Nächste"},prev:{DE:"Vorherige"},send:{DE:"Senden",EN:"Send"},name:{DE:"Name",EN:"Name"},date:{DE:"Datum",EN:"Date"},milestone:{DE:"Meilenstein",EN:"Milestone"},about:{DE:"Über",EN:"About"},"propertyeditor.error.required":{DE:"Pflichtfeld",EN:"Required"},"propertyeditor.error.email":{DE:"Bitte gültige E-Mail eingeben.",EN:"Please enter a valid email."},"propertyeditor.error.number":{DE:"Bitte gültige Zahl eingeben.",EN:"Please enter a valid number."}};a.value("translation",b)}]),angular.module("PReports").factory("language",["$log","translation",function(a,b){function c(){var a,b=navigator.language?navigator.language:navigator.userLanguage,c="preports.user.language";return window.localStorage&&(a=window.localStorage.getItem(c)),a?a:(("undefined"===b||0==b.length)&&(b="DE"),b.substring(0,2).toUpperCase())}var d=c(),e={get:function(){return c()},set:function(a){d=a},translate:function(a){return a&&b[a]?b[a][d]||"":""}};return e}]),angular.module("PReports.services").service("config",["$http",function(a){function b(){a.get(e.config_.getCombinedServiceUrl()+"/config/logo",{responseType:"blob"}).then(function(a){if(200==a.status){var b=new Blob([a.data],{type:"image/png"});e.config_.brandLogo=(window.URL||window.webkitURL).createObjectURL(b),e.config_.brandLogoExists=!0}else e.config_.brandLogoExists=!1},function(){e.config_.brandLogoExists=!1})}function c(){a.get(e.config_.getCombinedServiceUrl()+"/config/costtypes",{responseType:"application/json"}).then(function(a){200==a.status&&(e.config_.defaultCostTypes=a.data)},function(){})}function d(){b(),c()}var e=this;return e.config_={serviceUrl:"",servicePort:"",version:"1.8.1 Lumpy Lion",priceRegExp:/([0123456789]+)\.([0123456789]*)/,currencyFormats:{EUR:"$1,$2 €",USD:"$ $1.$2"},defaultCostTypes:[]},e.setConfig=function(a){e.config_.serviceUrl=a.serviceUrl,
e.config_.servicePort=a.servicePort,e.config_.priceRegExp=a.priceRegExp,e.config_.currencyFormats=a.currencyFormats},e.setServiceUrl=function(a){e.config_.serviceUrl=a},e.setservicePort=function(a){e.config_.servicePort=a},e.setPriceRegExp=function(a){e.config_.priceRegExp=a},e.config_.getCombinedServiceUrl=function(){return e.config_.serviceUrl?e.config_.servicePort?e.config_.serviceUrl+":"+e.config_.servicePort:e.config_.serviceUrl:location.protocol+"//"+location.host},e.setCurrencyFormats=function(a,b){1==arguments.length&&(e.config_.currencyFormats=a),2==arguments.length&&(e.config_.currencyFormats[a]=b)},d(),e.config_}]),angular.module("PReports.services").factory("errorHandler",["$rootScope","$location","$log","language","config",function(a,b,c,d,e){function f(b,e,f,g){var h,i,j;arguments.length>1?(h={},h.data=b,h.status=e,h.headers=f,h.config=g):h=b?b.hasOwnProperty("data")?b:{data:b}:{},i=h.data?h.data.errorKey||h.data:null,j=h.data?h.data.message:null,a.error=!0,a.errorMessage=d.translate(i)||d.translate("error."+h.status)||j||d.translate("error.general")||"Error during communication with service.",c.error("Error during http method, response object: "+angular.toJson(h))}return f.reset=function(){a.error=!1},f}]),angular.module("PReports.services").factory("notAuthenticatedInterceptor",["$log","$q","$location",function(a,b,c){return{response:function(a){return a},responseError:function(d){return 401===d.status&&(a.log("Request not authenticated status 401. Redirecting to login!"),window.location.href="//"+c.host()+":"+c.port()+"/login"),b.reject(d)}}}]),angular.module("PReports.services").config(["$httpProvider",function(a){a.interceptors.push("notAuthenticatedInterceptor")}]),angular.module("PReports.services").factory("loadingService",function(){var a={requestCount:0,isLoading:function(){return a.requestCount>0}};return a}),angular.module("PReports.services").factory("onStartInterceptor",["loadingService","$rootScope",function(a,b){return function(c){return a.requestCount++,b.ajaxLoading=a.isLoading(),c}}]),angular.module("PReports.services").factory("onCompleteInterceptor",["loadingService","$rootScope","$q",function(a,b,c){return{response:function(c){return a.requestCount--,b.ajaxLoading=a.isLoading(),c},responseError:function(d){return a.requestCount--,b.ajaxLoading=a.isLoading(),c.reject(d)}}}]),angular.module("PReports.services").config(["$httpProvider",function(a){a.interceptors.push("onCompleteInterceptor")}]),angular.module("PReports.services").run(["$http","onStartInterceptor",function(a,b){a.defaults.transformRequest.push(b)}]),angular.module("PReports.services").factory("helper",function(){var a={getFieldInputClass:function(a){return a.$dirty&&a.$invalid?"error":a.$dirty&&!a.$invalid?"success":""},isFunction:function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},isUrl:function(a){var b=/(^http|^https):\/\//;return a?b.test(a):!1},isZero:function(a){return 0===a?!0:!1},isValidDate:function(a){return"[object Date]"!==Object.prototype.toString.call(a)?!1:!isNaN(a.getTime())},getMaxWeeksPerYear:function(a){var b;if(this.isValidDate(a))return b=new Date(a.getFullYear(),11,28),b.getWeek();if("number"==typeof a)return b=new Date(a,11,28),b.getWeek();if("string"==typeof a){try{b=new Date(parseInt(a),11,28)}catch(c){return 52}return b.getWeek()}return 52}};return a}),angular.module("PReports.services").service("notification",["$http","config","errorHandler","$log","helper",function(a,b,c,d,e){var f={getProviders:function(f){a.get(b.getCombinedServiceUrl()+"/notifications/providers").success(function(a){e.isFunction(f)?f(a):d.error("notification: no callback function")}).error(function(a){d.error("Failed to get notification providers "+a),c(a)})}};return f}]),angular.module("PReports.services").service("commandService",["$log","errorHandler","$q",function(a,b,c){function d(){var b=i[0];"undefined"!==b&&null!=b&&b.undoPromise&&(b.undoPromise.then(function(){i.shift(),d()},function(){i=[],a.log("commandService: failed to undo command. Clear pending undos.")}),b.undo())}function e(){var b=h[0];"undefined"!==b&&null!=b&&b.promise&&(b.promise.then(function(){h.shift(),e()},function(){h=[],a.log("commandService: failed to execute command clear pending commands.")}),b.execute())}var f=20,g=[],h=[],i=[],j={storeAndExecuteCmd:function(b){var c,d=!0;if(!b)return void a.log("storeAndExecuteCmd: no command given");if("object"!=typeof b)return void a.log("storeAndExecuteCmd: command is not an object");if(!b.hasOwnProperty("execute")||"function"!=typeof b.execute)return void a.log("storeAndExecuteCmd: no execute method found or not a function");if(b.hasOwnProperty("undo")&&"function"==typeof b.undo||(a.log("storeAndExecuteCmd: no undo method found or not a function. Command not added to queue."),d=!1),d&&(g.length==f?(c=g.shift(),c=null,g.push(b)):g.push(b)),b.promise)0===h.length?(h.push(b),e()):(a.log(h.length+" pending commands. Put command in queue."),h.push(b));else try{b.execute()}catch(i){a.log("storeAndExecuteCmd: failed to execute command. "+i),g.pop(b),alert("commmand execution failed!")}},undo:function(){var b;g.length>0?(b=g.pop(),b.undoPromise?0===i.length?(i.push(b),d()):(a.log(i.length+" pending undos. Put command in queue."),i.push(b)):b.undo()):a.log("undo: no commands in queue")},getAmount:function(){return g.length},reset:function(){g=[],h=[],i=[]}};return j}]),angular.module("PReports.services").service("reportsService",["$log","errorHandler","$q","Report","$rootScope",function(a,b,c,d,e){function f(){e.search=e.search||{},e.search.year=e.search.hasOwnProperty("year")?e.search.year:(new Date).getFullYear(),e.search.week=e.search.hasOwnProperty("week")?e.search.week:(new Date).getWeek(),e.search.name=e.search.hasOwnProperty("name")?e.search.name:"",e.search.page=e.search.hasOwnProperty("page")?e.search.page:0,e.search.sortProperty=e.search.sortProperty||"week",e.search.sortDirection=e.search.sortDirection||"desc",a.debug("Init rootScope.search with "),a.debug(e.search)}function g(b){a.debug("getReports called with "+b);var c=d.query({year:b.year,week:b.week,name:b.name,page:b.page,limit:i,sortProperty:b.sortProperty,sortDirection:b.sortDirection});return c.$promise}var h={getReports:g};const i=25;return f(),h}]),angular.module("PReports.filters",[]).filter("breakFilter",function(){return function(a){return void 0!==a?a.replace(/\n/g,"<br />"):void 0}}),angular.module("PReports.directives").directive("l",["$locale","language","$interpolate",function(a,b,c){return function(a,d,e,f){function g(f){f&&(h=b.translate(f)||(l?e[l]:d.html()),i=c(h),(j||angular.noop)(),j=a.$watch(i,function(a,b){l?d.attr(l,a):d.html(a)}))}var h,i,j,k=e.l,l=e.lAttribute;e.$observe("l",g),g(k)}}]),angular.module("PReports.directives").directive("logout",["$http","$location",function(a,b){return{templateUrl:"views/templates/logout.html",restrict:"EA",link:function(a){}}}]),angular.module("PReports.directives").directive("signal",["$locale","language","$interpolate",function(a,b,c){var d={restrict:"AE",replace:!1,transclude:!0,priority:100,scope:{signalTitle:"@",onSignalChange:"&",signalField:"@",signalEntity:"=",signalEnabled:"="},templateUrl:"views/templates/signal.html",compile:function(a,b,c){return{pre:function(a,b,c,d){},post:function(a,b,c,d){var e;b.find(".signal-body");a.switchSignal=function(b){if(1==a.signalEnabled||"undefined"==typeof a.signalEnabled){switch(e=a.signalEntity[a.signalField],b){case"red":a.signalEntity[a.signalField]=1;break;case"yellow":a.signalEntity[a.signalField]=2;break;case"green":a.signalEntity[a.signalField]=3}a.onSignalChange({modifiedProperty:a.signalField,prevValue:e})}},a.isActive=function(b){return a.signalEntity&&a.signalEntity[a.signalField]==b?!0:!1}}}}};return d}]),angular.module("PReports.directives").directive("error",["$http","$location",function(a,b){return{templateUrl:"views/templates/error.html",restrict:"EA",link:function(a){}}}]),angular.module("PReports.directives").directive("composeButton",["$locale","language","$interpolate","$timeout","hotkeys",function(a,b,c,d,e){var f={restrict:"AE",replace:!1,transclude:!0,priority:100,scope:{cbTitle:"@",onClick:"&",datasource:"="},templateUrl:"views/templates/composeButton.html",compile:function(a,c,f){return{pre:function(a,b,c,d){},post:function(a,c,f,g){function h(){var a,b;a=angular.element(document).height(),b=angular.element(window).width(),k.css({width:b,height:a}),d(function(){n.trigger("focus")},150),k.show(),m.show(),j=e.get("esc"),e.del("esc"),e.add({combo:"esc",allowIn:["INPUT"],description:"Close new report dialog",callback:function(a){i()}})}function i(){k.hide(),m.hide(),e.del("esc"),e.add(j)}var j,k=c.find("div.compose-button-mask"),l=c.find("div.compose-button"),m=c.find("div.compose-button-dialog"),n=c.find("div.compose-button-dialog input");a.language=b,jQuery(".compose-button .fab").hover(function(){jQuery(this).toggleClass("active")}),jQuery(function(){jQuery('.compose-button > [data-toggle="tooltip"]').tooltip()}),l.bind("click",function(){a.newReportName="",h()}),k.bind("click",function(){i()}),a.save=function(){a.onClick()(a.newReportName)}}}}};return f}]),angular.module("PReports.directives").directive("simplePropertyEditor",["$timeout","$log","language","helper","$filter",function(a,b,c,d,e){function f(a){return c.translate(a)||a}function g(a){var b,c=(a.hasOwnProperty("editorRequired")?"required='required'":"",a.hasOwnProperty("editorRepeat")),d=(a.hasOwnProperty("editorPattern")?"ng-pattern='"+a.editorPattern+"'":"",a.hasOwnProperty("editorType")?a.editorType:"text");return c?("textarea"==d?b="":("email"!=d&&"password"!=d&&"number"!=d&&(d="text"),b='<div class="control-group" ng-class="getFieldInputClass(simplePropertyForm.repeatProperty.$invalid)"><div class="controls"><input type="'+d+'" name="repeatProperty" ng-model="editorRepeat" l-attribute="placeholder" l="propertyeditor.repeat.placeholder" required ng-change="matchInput()"></input><div class="help-inline" ng-show="simplePropertyForm.repeatProperty.$dirty && simplePropertyForm.repeatProperty.$invalid"><span ng-show="simplePropertyForm.repeatProperty.$error.required">'+f("propertyeditor.error.required")+'</span><span ng-show="simplePropertyForm.repeatProperty.$error.match">'+f("propertyeditor.error.match")+"</span></div></div></div>"),b):""}function h(a,b){var c,d=a.hasOwnProperty("editorRequired")&&!b?"required='required'":"",e=a.hasOwnProperty("editorPattern")?"ng-pattern='"+a.editorPattern+"'":"",g=a.hasOwnProperty("editorRepeat")?"ng-change='matchInput()'":"",h=a.hasOwnProperty("editorMaxLength")?"maxlength='"+a.editorMaxLength+"'":"",i=a.hasOwnProperty("editorPlaceholder")?"placeholder='"+f(a.editorPlaceholder)+"'":"",j=a.hasOwnProperty("editorType")?a.editorType:"text",k=a.hasOwnProperty("editorField")?a.editorField:"",l=b?"{{'simpleProperty'+"+b+"}}":"simpleProperty_"+k,m=b?"editorTranslations["+b+"]":"editorValue";return"textarea"==j?c='<p class="input-group"><textarea class="form-control" rows="8" cols="100" name="'+l+'" ng-model="'+m+'" '+h+" "+d+" "+e+" "+i+'></textarea><span type="button" class="btn btn-default input-group-addon" style="background-color: white;" ng-click="clearInput();"><i class="glyphicon glyphicon-remove"></i></span></p>':"datepicker"==j?c='<p class="input-group"><input class="form-control" type="'+j+'" '+i+' name="'+l+'" ng-model="'+m+'" '+h+" "+d+" "+e+" "+g+'></input><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="clearInput()"><i class="glyphicon glyphicon-remove"></i></button></span></p><uib-datepicker '+i+' name="'+l+'" ng-model="'+m+'" show-weeks="true"></uib-datepicker>':"richtext"==j?c='<div text-angular ng-model="'+m+'"></div>':("email"!=j&&"password"!=j&&"number"!=j&&"url"!=j&&(j="text"),c='<p class="input-group"><input class="form-control" type="'+j+'" '+i+' name="'+l+'" ng-model="'+m+'" '+h+" "+d+" "+e+" "+g+'></input><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="clearInput()"><i class="glyphicon glyphicon-remove"></i></button></span></p>'),c}function i(a){return a?"error":a?"":"success"}var j={restrict:"A",replace:!1,transclude:!0,scope:{editorTitle:"@",editorPatternText:"@",editorOnSave:"&",editorEnabled:"=",editorValidate:"&",editorValidateText:"@",editorPlaceholder:"@",editorProperty:"=",editorField:"@",editorEntity:"="},template:function(a,b){var c,d=(b.hasOwnProperty("editorRequired")?"required='required'":"",b.hasOwnProperty("editorPattern")?"ng-pattern='"+b.editorPattern+"'":"",b.hasOwnProperty("editorField")?b.editorField:null),e=b.hasOwnProperty("editorEntity")?b.editorEntity:null,i=b.hasOwnProperty("editorValidateText")?b.editorValidateText:"propertyeditor.error.custom";return c=d&&e?'<div class="toggler" ng-transclude></div><div class="simple-property-editor-mask"></div><div class="simple-property-editor" style="display:none; position:absolute; background-color:white;"><h5 class="editor-title" l="{{editorTitle}}">Edit property</h5><form name="simplePropertyForm" novalidate ng-submit="save()" class="edit-property-form"><div class="edit-property-form-inputs"><div class="control-group" ng-class="getFieldInputClass(simplePropertyForm.$invalid)"><div class="controls">'+h(b)+'<div class="help-inline text-danger" ng-show="simplePropertyForm.$dirty && simplePropertyForm.$invalid"><p ng-show="simplePropertyForm.$error.required && !simplePropertyForm.$error.custom">'+f("propertyeditor.error.required")+'</p><p ng-show="simplePropertyForm.$error.number && !simplePropertyForm.$error.custom">'+f("propertyeditor.error.number")+'</p><p ng-show="simplePropertyForm.$error.pattern && !simplePropertyForm.$error.custom">'+f("propertyeditor.error.pattern")+'</p><p ng-show="simplePropertyForm.$error.custom">'+f(i)+'</p><p ng-show="simplePropertyForm.$error.email && !simplePropertyForm.$error.custom" >'+f("propertyeditor.error.email")+'</p></div></div></div><div ng-repeat="t in editorEntity.translations"><div class="control-group" ng-class="getFieldInputClass(simplePropertyForm.simpleProperty{{t.lang}}.$invalid)"><div class="controls"><label>{{getLanguageTitle(t.lang)}}</label>'+h(b,"t.lang")+'<i class="icon-remove icon-black" ng-click="clearInput(t.lang)"></i></div></div></div></div><div class="row-fluid" style="margin-top: 5px"><button type="button" ng-click="closeDialog()" class="btn btn-default" data-dismiss="modal" style="margin-right: 5px;">'+f("cancel")+'</button><button type="submit" class="btn btn-success" ng-disabled="!isValid()">'+f("save")+"</button></div></form></div>":'<div class="toggler" ng-transclude></div><div class="simple-property-editor-mask"></div><div class="simple-property-editor" style="display:none; position:absolute; background-color:white;"><h5 class="editor-title" l="{{editorTitle}}">Edit property</h5><form name="simplePropertyForm" novalidate ng-submit="save()" class="edit-property-form"><div class=""><div class="control-group" ng-class="getFieldInputClass(simplePropertyForm.$invalid)"><div class="controls">'+h(b)+'<i class="glyphicon glyphicon-remove" ng-click="clearInput()"></i><div class="help-inline text-danger" ng-show="simplePropertyForm.$dirty && simplePropertyForm.$invalid"><p ng-show="simplePropertyForm.$error.required && !simplePropertyForm.$error.custom">'+f("propertyeditor.error.required")+'</p><p ng-show="simplePropertyForm.$error.number && !simplePropertyForm.$error.custom">'+f("propertyeditor.error.number")+'</p><p ng-show="simplePropertyForm.$error.pattern && !simplePropertyForm.$error.custom">'+f("propertyeditor.error.pattern")+'</p><p ng-show="simplePropertyForm.$error.custom">'+f(i)+'</p><p ng-show="simplePropertyForm.$error.email && !simplePropertyForm.$error.custom" >'+f("propertyeditor.error.email")+"</p></div></div></div>"+g(b)+'</div><div class="row-fluid"><button type="button" ng-click="closeDialog()" class="btn btn-default span6" data-dismiss="modal">'+f("common.cancel")+'</button><button type="submit" class="btn btn-success span6" ng-disabled="simplePropertyForm.$invalid">'+f("common.save")+"</button></div></form></div>"},compile:function(c,f,g){var h=(f.hasOwnProperty("editorRequired")?"required='required'":"",f.hasOwnProperty("editorPattern")?"ng-pattern='"+f.editorPattern+"'":"",f.hasOwnProperty("editorField")?f.editorField:null,f.hasOwnProperty("editorEntity")?f.editorEntity:null,f.hasOwnProperty("editorType")?f.editorType:"text");return{pre:function(a,b,c,d){a.dateOptions={"show-button-bar":!1,"show-weeks":!0},a.status={opened:!1}},post:function(c,f,g,j){function k(a){if(a){if(angular.isDate(a))return m.$setValidity("date",!0),a;if(angular.isString(a)){var b=new Date(a);return isNaN(b)?(m.$setValidity("date",!0),a):(m.$setValidity("date",!0),b)}return m.$setValidity("date",!1),a}return m.$setValidity("date",!0),null}function l(a){var b;return console.log("Formatting value "+a),a?(b=new Date(a),d.isValidDate(b)?e("date")(a,"yyyy-MM-dd"):a):void 0}var m,n=f.find("div.simple-property-editor"),o=f.find("div.simple-property-editor-mask"),p=f.find("input.property-input, input.form-control, textarea.property-input, textarea.form-control"),q=g.hasOwnProperty("editorEntity");c.editorField&&(m=c.simplePropertyForm["simpleProperty_"+c.editorField]),g.hasOwnProperty("editorValidate")&&m&&(m.$parsers.pop(),m.$parsers.push(function(a){return c.editorValidate?c.editorValidate({value:a})?(m.$setValidity("custom",!0),a):void m.$setValidity("custom",!1):void 0})),"datepicker"==h&&m&&(m.$parsers.pop(),m.$parsers.push(k),m.$formatters.push(l),c.dateOptions={"show-button-bar":!1,"show-weeks":!0}),c.save=function(){c.isValid()&&(c.saved=!0,q?(c.prevValue=c.editorEntity[c.editorField],c.editorEntity[c.editorField]=c.editorValue,angular.forEach(c.editorEntity.translations,function(a,b){a[c.editorField]=c.editorTranslations[b]})):c.editorProperty=c.editorValue,a(function(){c.editorOnSave({modifiedProperty:c.editorField,prevValue:c.prevValue})}),o.hide(),n.hide())},c.isValid=function(){return c.simplePropertyForm.$valid&&!c.saved||"datepicker"==h},c.closeDialog=function(){o.hide(),n.hide()},c.clearInput=function(a){if(a){c.editorTranslations[a]="";var b='[name="simpleProperty'+a+'"]';f.find("input"+b+".property-input, textarea"+b+".property-input").trigger("focus")}else c.editorValue="",p.trigger("focus");c.editorRepeat&&(c.editorRepeat="")},c.matchInput=function(){c.simplePropertyForm.simpleProperty.$viewValue!==c.simplePropertyForm.repeatProperty.$viewValue?c.simplePropertyForm.repeatProperty.$setValidity("match",!1):c.simplePropertyForm.repeatProperty.$setValidity("match",!0)},c.getLanguageTitle=function(a){return a?langcodesMap[a]?langcodesMap[a].lang:a:void 0},c.open=function(b){a(function(){c.status.opened=!0})},c.status={opened:!1},f.find("div.toggler").bind("click",function(){if(1==c.editorEnabled||"undefined"==typeof c.editorEnabled){c.editorRepeat="",c.saved=!1,q?(c.editorValue=c.editorEntity[c.editorField],c.editorTranslations={},angular.forEach(c.editorEntity.translations,function(a,b){c.editorTranslations[b]=a[c.editorField]})):c.editorValue=c.editorProperty,c.$digest();var a,d,e,g,h,i;d=f.find("div.toggler").offset().top-f.find("div.toggler").offsetParent().offset().top,a=f.find("h5.editor-title").css("lineHeight"),a=a.replace("px",""),h=f.find("div.value"),e=$(document).height(),g=$(window).width(),o.css({width:g,height:e}),o.show();try{h&&1==h.length?(i=h.offset().left-h.offsetParent().offset().left,n.css("left",i)):f.parent().is("td")&&(i=f.offset().left-f.offsetParent().offset().left,n.css("left",i))}catch(j){b.error("simplePropertyEditor: failed to calculate left")}n.css("top",d-a-25),n.show(),p.trigger("focus")}}),o.bind("click",function(){c.closeDialog()}),n.bind("keyup",function(a){27==a.which&&c.closeDialog()}),c.getFieldInputClass=i}}}};return j}]),angular.module("PReports.directives").directive("simpleConfirmDialog",["language","$log","$timeout","$compile","$document",function(a,b,c,d,e){var f=1,g={restrict:"A",replace:!1,transclude:!0,priority:100,scope:{dialogTitle:"@",dialogText:"@",dialogOnConfirm:"&",dialogConfirmButton:"@",dialogDisabled:"=",dialogConfirmBtnCls:"@"},template:function(a,b){var c;b.hasOwnProperty("dialogConfirmBtnCls")?b.dialogConfirmBtnCls:"btn-primary";return c='<span class="toggler" ng-transclude></span>'},compile:function(a,b,g){var h=(Date.now()+"_scd",b.hasOwnProperty("dialogConfirmBtnCls")?b.dialogConfirmBtnCls:"btn-primary"),i='<div class="modal confirm-modal" id="{{::uniqueId}}" ><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">×</button><h4 l="{{dialogTitle}}">Confirm dialog</h4></div><div class="modal-body"><p l="{{dialogText}}"></p></div>  <div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal" l="cancel">Cancel</button><button type="button" class="btn '+h+'" data-dismiss="modal" ng-click="confirm()" l="{{dialogConfirmButton}}">Confirm</button></div></div></div></div>';return{pre:function(a,b,c,d){},post:function(a,b,g,h){a.uniqueId="scd_"+f++;var j=d(i)(a);e.find("div[ng-view]").prepend(j),a.confirm=function(){var b;b=angular.element(e[0].body).find("#"+a.uniqueId),b.modal("hide"),c(a.dialogOnConfirm,150)},b.find(".toggler").bind("click",function(){var b;a.dialogDisabled||(b=angular.element(e[0].body).find("#"+a.uniqueId),b.modal("toggle"))})}}}};return g}]),angular.module("PReports.directives").directive("tooltip",["$locale","language",function(a,b){return function(a,c,d,e){var f,g=d.tooltip,h=d.tooltipPosition||"top";g&&(f=b.translate(g)||g,f&&c.tooltip({title:f,placement:h}))}}]),angular.module("PReports.directives").directive("costTypeDialog",["$locale","language","$interpolate","$log",function(a,b,c,d){function e(a,b,c,d){a.costReport=a.$parent.currentReport}var f={restrict:"AE",transclude:!0,scope:{costReport:"=report",onChange:"&"},controller:CostTypeController,controllerAs:"ctrl",bindToController:!0,templateUrl:"views/templates/costTypeDialog.html",link:e};return f}]),CostTypeController.$inject=["$scope","$log","$q","commandService","config","helper"];